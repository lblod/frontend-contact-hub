<EditCard @containsRequiredFields={{true}}>
  <:title>Heeft relatie met</:title>
  <:card as |Card|>
    <Card.Columns>
      <:left as |Item|>
        <Item
          @labelFor="related-gemeente"
          @required={{false}}
          @errorMessage={{@model.administrativeUnit.error.isSubOrganizationOf.validation}}
        >
          <:label>Gemeente</:label>
          <:content as |hasError|>
            <MunicipalitySelect
              @selected={{@model.administrativeUnit.isSubOrganizationOf}}
              @onChange={{fn
                (mut @model.administrativeUnit.isSubOrganizationOf)
              }}
              @error={{hasError}}
              @id="related-gemeente"
            />
          </:content>
        </Item>
        <Item @labelFor="related-municipality">
          <:label>Provincie</:label>
          <:content>
            {{@model.administrativeUnit.isSubOrganizationOf.isSubOrganizationOf.name}}
          </:content>
        </Item>
      </:left>
    </Card.Columns>
  </:card>
</EditCard>

<div>
  {{#if @model.administrativeUnit.error.hasParticipants.validation}}
    <div>
      <AuHelpText @error={{true}}>{{@model.administrativeUnit.error.hasParticipants.validation}}</AuHelpText>
    </div>
  {{/if}}

  <AuDataTable
    id="relatedMemberships"
    @content={{@model.relatedMemberships}}
    @noDataMessage="Geen bestuur"
    as |t|
  >
    <t.content as |c|>
      <c.header>
        <th>Type relatie</th>
        <th>Type organisatie</th>
        <th>Organisatie</th>
        <th>Status</th>
        <th></th>
      </c.header>
      <c.body as |membership|>
        <td>
          <RelationTypeSelect
            @selected={{membership.role}}
            @onChange={{fn (mut membership.role)}}
            @administrativeUnit={{@model.administrativeUnit}}
            id="relation-type"
          />
        </td>
        <td>
          {{membership.classification.label}}
        </td>
        <td>
          <AdministrativeUnitSelect
            @selected={{membership.member}}
            @onChange={{fn @updateMembership membership}}
            @classificationCodes={{@classificationCodesIgsParticipants}}
          />
        </td>
        <td>
          <OrganizationStatus
            @id={{membership.member.organizationStatus.id}}
            @label={{membership.member.organizationStatus.label}}
          />
        </td>
        <td>
          <AuButton
            @alert={{true}}
            @icon="bin"
            @iconAlignment="left"
            @skin="link"
            {{on
              "click"
              (fn @removeMembership membership)
            }}
          >
            Verwijder
          </AuButton>
        </td>
      </c.body>
    </t.content>
  </AuDataTable>

  <div class="au-o-box au-o-box--small">
    <AuButton
      @skin="secondary"
      @width="block"
      @icon="add"
      @iconAlignment="left"
      {{on "click" @addNewMembership}}
    >
      Voeg nieuwe gerelateerde organisatie toe
    </AuButton>
  </div>
</div>
